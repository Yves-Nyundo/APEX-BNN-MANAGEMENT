<!-- templates/inventory/list.html -->
{% extends "base.html" %}
{% block title %}Inventory{% endblock %}

{% block content %}

<h1 class="text-2xl font-bold mb-6">Inventory</h1>

<!-- Flash Messages -->
<div id="flashes">
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="p-3 mb-4 text-sm rounded-md
          {% if category == 'success' %}bg-green-100 text-green-800 border border-green-200
          {% elif category == 'error' %}bg-red-100 text-red-800 border border-red-200
          {% elif category == 'warning' %}bg-yellow-100 text-yellow-800 border border-yellow-200
          {% else %}bg-blue-100 text-blue-800{% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}
</div>

<!-- Search & Filter & Add -->
<div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-6">
  <form method="GET" class="flex-1 max-w-md">
    <input type="text"
           name="q"
           value="{{ request.args.get('q', '') }}"
           placeholder="Search items..."
           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-purple-500">
  </form>

  <div class="flex gap-2">
    <select name="status" onchange="this.form.submit()" class="px-3 py-2 border border-gray-300 rounded-md text-sm">
      <option value="">All Status</option>
      <option value="in_stock" {% if request.args.get('status') == 'in_stock' %}selected{% endif %}>In Stock</option>
      <option value="low_stock" {% if request.args.get('status') == 'low_stock' %}selected{% endif %}>Low Stock</option>
      <option value="out_of_stock" {% if request.args.get('status') == 'out_of_stock' %}selected{% endif %}>Out of Stock</option>
    </select>

    <select name="category" onchange="this.form.submit()" class="px-3 py-2 border border-gray-300 rounded-md text-sm">
      <option value="">All Categories</option>
      {% for cat in categories | sort %}
        <option value="{{ cat }}" {% if request.args.get('category') == cat %}selected{% endif %}>{{ cat | capitalize }}</option>
      {% endfor %}
    </select>
  </div>

  <a href="{{ url_for('add_inventory_item') }}" class="bg-purple-600 text-white px-4 py-2 rounded-md text-center text-sm font-medium">+ Add Item</a>
</div>

<!-- Inventory Table -->
{% if items and items.items %}
  <div class="overflow-x-auto">
    <table class="min-w-full bg-white rounded-lg shadow divide-y divide-gray-200">
      <thead class="bg-gray-50">
        <tr>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Name</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Desc</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Qty</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Reorder</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Cost</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Category</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
          <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
        </tr>
      </thead>
      <tbody class="divide-y divide-gray-200">
        {% for item in items.items %}
        <tr class="hover:bg-gray-50 transition-colors">
          <td class="px-4 py-3 font-medium text-gray-800">{{ item.name }}</td>
          <td class="px-4 py-3 text-gray-600 truncate max-w-xs" title="{{ item.description }}">{{ item.description or '-' }}</td>
          <td class="px-4 py-3 text-gray-800">{{ item.quantity_on_hand or 0 }}</td>
          <td class="px-4 py-3 text-gray-800">{{ item.reorder_point or '-' }}</td>
          <td class="px-4 py-3 text-gray-800">${{ "%.2f"|format(item.unit_cost) }}</td>
          <td class="px-4 py-3 text-gray-600">{{ item.category or 'General' }}</td>
          <td class="px-4 py-3">
            <span class="px-2 py-1 rounded-full text-xs font-medium
              {% if item.quantity_on_hand <= 0 %}bg-gray-100 text-gray-800
              {% elif item.quantity_on_hand <= item.reorder_point %}bg-red-100 text-red-800
              {% else %}bg-green-100 text-green-800{% endif %}">
              {% if item.quantity_on_hand <= 0 %}Out of Stock
              {% elif item.quantity_on_hand <= item.reorder_point %}Low Stock
              {% else %}In Stock{% endif %}
            </span>
          </td>
          <td class="px-4 py-3 space-x-2 text-sm">
            <a href="{{ url_for('edit_inventory_item', item_id=item.id) }}" class="text-blue-600 hover:underline">Edit</a>
            |
            <form method="POST" action="{{ url_for('delete_inventory_item', item_id=item.id) }}" style="display:inline;" onsubmit="return confirm('Delete {{ item.name }}?')">
                {{ delete_form.hidden_tag() }}
                {{ delete_form.submit(class="text-red-600 hover:underline bg-transparent border-none p-0 cursor-pointer") }}
            </form>

          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <div class="flex justify-between items-center mt-6">
    <span class="text-sm text-gray-600">
      Page {{ items.page }} of {{ items.pages }} ({{ items.total }} items)
    </span>
    <div class="flex gap-2">
      {% if items.has_prev %}
        <a href="{{ url_for('list_inventory', q=request.args.get('q'), status=request.args.get('status'), category=request.args.get('category'), page=items.prev_num) }}"
           class="px-3 py-1 bg-white border border-gray-300 rounded-md text-sm hover:bg-gray-50">Previous</a>
      {% endif %}
      {% if items.has_next %}
        <a href="{{ url_for('list_inventory', q=request.args.get('q'), status=request.args.get('status'), category=request.args.get('category'), page=items.next_num) }}"
           class="px-3 py-1 bg-white border border-gray-300 rounded-md text-sm hover:bg-gray-50">Next</a>
      {% endif %}
    </div>
  </div>

{% else %}
  <p class="text-gray-500 py-8 text-center">No inventory items found.</p>
{% endif %}

{% endblock %}